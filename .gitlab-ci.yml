stages:
    - build

variables:
    VERSION: 1.0.0
    IMAGE_NAME: registry.united-asian.com/polifonic/php70

build:
    stage: build
    script:
        - docker build -t $IMAGE_NAME .
        - docker login -u gitlab-ci-token -p $CI_BUILD_TOKEN registry.united-asian.com
        - docker push $IMAGE_NAME:$VERSION.$CI_BUILD_ID
        - docker tag $IMAGE_NAME:$VERSION.$CI_BUILD_ID $IMAGE_NAME:latest
        - docker push $IMAGE_NAME:latest
    tags:
        - docker
        - polifonic
        - st3
